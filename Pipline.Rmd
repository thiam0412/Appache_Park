---
title: "R Notebook"
output: html_notebook
---

## Création de pipline machine avec spark 

```{r}
seed=123
pipline=ml_pipeline(sc) %>%
      # imputation des valeurs manquantes par la médiane 
      ft_imputer(
            input_cols =c(
              " load_int_rate", 
              "person_emp_length"
            ),
            output_cols =c( 
               "imputer_load_int_rate", 
               "imputer_person_emp_length"
              ), 
            strategy = "median"
      ) %>%
     # transformation des variables catégorielles en variable numériques 
      ft_string_indexer(
          input_col= "person_home_ownership", 
          output_col="person_home_ownership_indexed"
            )%>%
      
      ft_string_indexer(
          input_col= "loan_intent", 
          output_col="loan_intent_indexed"
            )%>%
      ft_string_indexer(
          input_col= "loan_grade", 
          output_col="loan_grade_indexed"
            )%>%
      ft_string_indexer(
          input_col= "cb_person_default_on_file", 
          output_col="cb_person_default_on_file_indexed"
            )%>%
    ft_one_hot_encoder(
            input_cols =c("cb_person_default_on_file_encoded", 
                          "loan_intent_indexed", 
                          "loan_grade_indexed",
                          "loan_grade_indexed"
                          ), 
            output_cols =c("cb_person_default_on_file_encoded", 
                           "loan_intent_encoded", 
                           "loan_grade_encoded",
                           "loan_grade_encoded"
                           ),
            )%>%
    
    # Creation de vecteur de varaibles indépendantes
     
     ft_vector_assembler(
         input_cols = c(  "person_age",
                          "person_income", 
                          "imputer_load_int_rata", 
                          "imputer_person_emp_length",
                          "person_home_ownership_encoded", 
                           "loan_intent_encoded", 
                           "loan_grade_encoded",
                           "loan_grade_encoded",
                           "loan_amnt",
                           " loan_percent_income", 
                           "cb_person_cred_hist_length"
         
                       ),
         output_col = "features" 
     
     )%>%
  # standarisation
   
     ft_standard_scaler(
       input_col ="features", 
       output_col = "features_scale", 
       with_mean =TRUE 
     )%>% 
  # Estimateur : algorithme de machine learning 
  
   ml_random_forest_classifier( 
     features_col ="features_scale", 
     label_col = "loan_status", 
     seed = seed 
     )
```

# class du pipline : 
```{r}
class(pipline)
```
# affichage

```{r}
pipline
```

































